---
title: "Udacity DAND Project: ExploreAndSummarizeData"
author: "Jubin Soni"
date: "August 27, 2017"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/', echo = FALSE, warning=FALSE, message = FALSE)
```

#### In this project I have performed Exploratory Data Analysis on the White wine dataset. In this dataset the wine quality is of particular interest to me. I have performed Univariate, Bivariate and Multivariate analysis and explored various factors that affect and correlate with the wine quality.

GitHub Link: <a href='https://github.com/jubins/DAND-Nanodegree/blob/master/dandp5-exploreandsummarizedatainR/Udacity%20DAND%20Project_%20ExploreAndSummarizeData.pdf'>EDA: Univariate, Bivariate and Multivariate Analysis on White Wine Dataset</a>

## Loading all the packages
```{r}
library(ggplot2)
library(grid)
library(gridExtra)
library(dplyr)
library(tidyr)
```

## Loading the Dataset
```{r}
wine <- read.csv("wineQualityWhites.csv", row.names = NULL)
```

## Initial Data Exploration
```{r}
names(wine)
str(wine)
summary(wine)
```
### Structure of Dataset
The dataset on white wines has 4898 observations of 13 variables. The main feature of interest is quality and alcohol content.

## Univariate Analysis
### Histogram of Quality of Wine
```{r}
library(ggplot2)
ggplot(aes(x = quality), data = wine) +
  geom_histogram(bins=7)
```

We see that the quality is close to a normal distribution, the graph is which is not fully symmetric because the quality 5 is higher than its corresponding value. However looking at the quality of 6 being highest we can say that the quality is above average.

### Histogram of Alcohol
```{r}
ggplot(aes(x=alcohol), data=wine)+
  geom_histogram()
```

This histogram shows us that the majority of the wines in dataset have alcohol content between 9 to 12.

### Histogram of Sulphates
```{r}
ggplot(aes(x=sulphates), data=wine)+
  geom_histogram()
```

The histogram shows that majrity of sulphates in wine are between 0.3 to 0.6, other are less than 200.

### Histogram of pH
```{r}
ggplot(aes(x=pH), data=wine)+
  geom_histogram()
```

The pH is very narrow for White Wine between 2.7 to 3.8, so it seems like these values are within the acidity range and no alkaline (which is above 7)

### Histogram of Wine Density
```{r}
ggplot(aes(x = density), data = subset(wine, density<1.01)) +
  geom_histogram(binwidth = 0.001)
```

The distribution below shows that density is within 0.9 to 1.0 range.

### Histogram of Total.Sulfur.Dioxide
```{r}
ggplot(aes(x = total.sulfur.dioxide), data = wine) + 
  geom_histogram()
```

The histogram of Sulfur Dioxide shows normal distribution in the White wine.

### Histogram of Free.Sulfur.Dioxide
```{r}
ggplot(aes(x = free.sulfur.dioxide), data = wine) + 
  geom_histogram()
```

This histogram shows us that free.sulfur.dioxide in wine range from 0 to 100, and show normal distribution.


### Histogram of Chlorides
```{r}
ggplot(aes(x = chlorides), data = wine) + 
  geom_histogram()
```

Majority of chlorides in wine are above 1500 and range between 0 to 0.1

### Histogram of Residual.sugar
```{r}
ggplot(aes(x = residual.sugar), data = wine) +
  geom_histogram() +
  scale_x_log10()
```

The histogram of residual sugar shows that as the count of sugar in whitewine does not follow any standard distribution. It has low peaks at left and right and low peak in the middle of distribution.

### Histrogram of Citric.Acid
```{r}
ggplot(aes(x = citric.acid), data = wine) + 
  geom_histogram()
```

The Citric.Acid value ranges from 0 to 0.5 and the distribution is normal in white wine.

### Histogram of Volatile.Acidity
```{r}
ggplot(aes(x = volatile.acidity), data = wine) + 
  geom_histogram()
```

There are lot of 0.29 valued entries in volatile.acidity.

### Histogram of fixed.acidity value of wine
```{r}
ggplot(aes(x = fixed.acidity), data = wine) + 
  geom_histogram()
```

The histogram of acidity of potential shows normal distribution.

### Outliers
#### Residual.sugar
```{r}
grid.arrange(ggplot(wine, aes(x=1, y=residual.sugar))+
               geom_jitter(alpha=0.1)+
               geom_boxplot(alpha=0.2, color='red'),
             ggplot(wine, aes(x=residual.sugar))+
               geom_histogram(bins=30), ncol=2
             )
```

There is unusual distrbution of 1s of the residual.sugar in the dataset.

```{r}
#removing outliers in residual.sugar with mean
wine$residual.sugar[wine$residual.sugar==1] <- mean(wine$residual.sugar)
```

#### Volatile.Acidity
```{r}
ggplot(aes(x = volatile.acidity), data = wine) + 
  geom_histogram()
```
There is a lot distributions valued 0.29 in the dataset. However this does not seem to be an issue because there are other values in Volatile.Acidity as well.

### Creating new variable: Rating
```{r}
wine$rating <- ifelse(wine$quality < 5, 'bad', 
                      ifelse(wine$quality < 7, 'average', 'good'))

wine$rating <- ordered(wine$rating, 
                       levels = c('bad', 'average', 'good'))

```

### Univariate Analysis Questions and Findings
#### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
I think further investigation weather pH could be classified into categorial (acid, base, neutral) could potentially be of interest. Also the relationship between fixed.acidity, volatile.acidity, and citric.acid (in particular this one due to the large number of 0s) could be interesting to further investigate in order to understand if the values are properly reported. This would require to understand the theoretical relationship between these variables.

#### Did you create any new variables from existing variables in the dataset?
I created new rating variable, to visualize the quality of wine by setting threshold on quality values, if wine.quality<5, rating is 'bad', if 5<wine.quality<7 rating is 'average' else the rating is 'good'.

I created the variable (ordered factor) rating to classify wine as good, bad or average. The information that the other variables store there does not seem to be any other variable that would fit well a sub-classification into categorical variables, perhaps with the exception of residual pH (neutral, base, acid).

#### Of the features you investigated, were there any unusual distributions?
I created Boxplots in Bivariate analysis to gain a better understanding wrt. outliers (except for X for being an index, and quality for being categorical). I've also plotted the data using a log10 scale in Univariate analysis (I plotted for all variables, although only those with long tails are interesting for the log10 scale -- plots below the box plots). These plots have shown that fixed acidity and to some extent pH, chlorides, densitiy, sulphates, volatile acidity to follow a normal distribution. As for the acidity variables, this is aligned with the fact that pH seems to be normally distributed, apart from the citric acid. The reason for the latter might be the number of 0 (potentially non-responses) discussed earlier. pH is normally distribution which suggests that the data is good, since by definition it is a measure of acidity and is on a logarithmic scale.

#### Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I've not found the need to tidy, adjust, or change the form of the data.

### Bivariate Analysis
Let us check how is the distribution of quality and alcohol content in wine. To do this creating a new variable alcohol.bucket.
```{r}
ggplot(aes(factor(quality),alcohol), data=wine)+
  geom_jitter(alpha=0.3)+
  geom_boxplot(alpha=0.5, color='blue')+
  stat_summary(fun.y="mean",
               geom = "point",
               color="red",
               shape=8,
               size=4)
#wine$alcohol.bucket <- cut(wine$alcohol, c(8,9,10,11,12,13,14))
#qplot(x = alcohol.bucket, y= quality, data = wine, geom = 'boxplot')
```

The graphs shows us that alcohol and wine quality have clear correlation.

#### Scatterplot of quality and Sulfur.Dioxide
```{r}
ggplot(aes(x=quality, y=total.sulfur.dioxide), data=wine)+
  geom_jitter(alpha=1/6)
```

This plot shows that in white wine quality of 5,6,7 has majority of Sulfur.Dioxide in it.

### Scatter plot of Fixed.Acidity and Density
```{r}
ggplot(aes(x=fixed.acidity, y=density), data=wine)+
  geom_point(alpha=0.3, size=1)+
  geom_smooth(method = "lm", se=FALSE, size=1)+
  xlim(4,12)+
  ylim(0.985,1.005)
```

We see that there is linear relationsip between fixed.acidity and density of wine. As the fixed.acidity increases the density increases however between for fixed.aidity between 5 and 8 the density is between 0.9 to 1.0.

#### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
I noticed that the following characteristics yield 'good' wines:
<ul><li>Acidity: higher fixed acidity and citric acid; lower volative acidity</li>
<li>Lower pH (~3.5)</li>
<li>Higher Sulphates</li>
<li>Higher Alcohol</li>
<li>Lower density</li>
<li>Regular chlorides and sugar do not seem to impact much on the quality.</li><ul>

#### Did you observe any interesting relationships between other features and not the main features of interest?
Below I have calculated the correlation between variables that correlate the most with quality: citric acid, sulphates, alcohol and volatile acidity.

Also the Pearson test revealed that volatile acidity and citric acid have strong negative correlation.
```{r}
with(wine, cor.test(citric.acid, alcohol))
with(wine, cor.test(sulphates, alcohol))
with(wine, cor.test(volatile.acidity, alcohol))
with(wine, cor.test(sulphates, citric.acid))
with(wine, cor.test(sulphates, volatile.acidity))
with(wine, cor.test(volatile.acidity, citric.acid))
```
#### What was the strongest relationship you found?
The quality shows the strongest correlation with alcohol (0.4761663). I also observed that volatile.acidity and alcohol, and suplhates and alcohol show weakest bi-variate relationship.

```{r}
with(wine, cor.test(quality, alcohol))
```

### Multivariate Analysis
#### Talk about some of the relationships you observed in this investigation. Were there features that stregthened each other in terms of looking at your feature(s) of interest?
I focused on 4 features that showed strong correlation with quality and pH, I found that the key factors that help in achieving good wine quality are higher sulphates, higher alcohol, lower volatile acid and higher citric acid.
```{r}
library(ggplot2)

plotRating <- function(x, y, xl, yl){
  ggplot(data = wine, aes(x=x, y=y, color=rating))+
    geom_point()+
    xlab(xl)+
    ylab(yl)
}

plotRating(wine$citric.acid, wine$alcohol, 'citric acid', 'alcohol')

plotRating(wine$sulphates, wine$alcohol, 'sulphates', 'alcohol')
```

This scatter plot shows us that the majority of the ratings given to acohol are average and it depends on the key factors above. Also when the alcohol content is low there are majority of bad rated wines and where alcohol content is high, wine quality is rated as good.

```{r}
plotRating(wine$volatile.acidity, wine$alcohol, 
           'volatile acidity', 'alcohol')
plotRating(wine$sulphates, wine$citric.acid, 'sulphates', 
           'citric acid')
plotRating(wine$sulphates, wine$volatile.acidity, 'sulphates', 
           'volatile acidity')
plotRating(wine$volatile.acidity, wine$citric.acid, 'volatile acidity', 
           'citric acid')
plotRating(wine$pH, wine$alcohol, 'pH', 'alcohol')
```

In the plots above, Sulphates an Citric.Acid, Sulphates and Volatile.Acidity we see a good number are rated as average and there is mix of good and bad ratings so we cannot infer anything. The pH and Alcohol relationship shows that similar to Sulphates and Alcohol, majority of the wines have good rating where alcohol content is higher, and bad rating where alcohol content is lower, eventhough pH is fairly constant in both cases. And Higher Volatile.Acidity is causes the wine quality to decrease as with it the Citric.Acid increases.

```{r}
ggplot(aes(x=alcohol, y=residual.sugar, color = factor(quality)), data=wine)+
  geom_point(alpha=0.8, size=1)+geom_smooth(method = "lm", se = FALSE, size = 1)+
  scale_color_brewer(type = 'seq', guide=guide_legend(title = 'Quality'))+
  ylim(0,25)
```

From the above plot we can see that lower residual sugar and higher alcohol content leads to better wine quality.

## Final Plots and Summary
### Plot One
These plots show the effect of acidity and pH on wine quality. I observe that higher acidity (lower pH), apart from the volatile acid, is shown to yield better wines. Higher acidity and lower pH also makes sense because these variables are correlated and this is why acidity is inline with pH (making a balance for good wine).
```{r}
grid.arrange(ggplot(data=wine, aes(x=factor(quality), y=fixed.acidity))+
               ggtitle('Effect of Acidity on Quality')+
               ylab('Fixed Acidity (g/dm^3)')+
               xlab('Quality')+
               geom_boxplot(),
             ggplot(data=wine, aes(x=factor(quality), y=volatile.acidity))+
               ggtitle('Effect of Volatile Acidity on Quality')+
               ylab('Volatile Acidity (g/dm^3)')+
               xlab('Quality')+
               geom_boxplot(),
             ggplot(data=wine, aes(x=factor(quality), y=citric.acid)) +
               ggtitle('Effect of Citric Acid on Quality')+
               ylab('Citric Acid (g/dm^3)')+
               xlab('Quality')+
               geom_boxplot(),
             ggplot(data=wine, aes(x=factor(quality), y=pH))+
               ggtitle('Effect of pH on Quality')+
               ylab('pH')+
               xlab('Quality')+
               geom_boxplot()
             )
```

### Plot Two
These plots show the effect of alcohol on wine quality. On avergae, we observe that the wine quality increases with alcohol, except for wine quality 5. To futher understand the difference between quality 4 and 5, I computed the stats considering only wines with that rating.
```{r}
ggplot(data=wine, aes(x=factor(quality), y=alcohol))+
  geom_boxplot()+
  ggtitle('Alcohol Levels in Different Wine Qualities')+
  xlab('Quality')+
  ylab('Alcohol (% volume)')

ggplot(data=wine, aes(x=rating, y=sulphates))+
  geom_boxplot()+
  ggtitle('Sulphates Levels in Different Wine Qualities')+
  xlab('Quality')+
  ylab('Sulphates (g/dm^3)')
```
```{r}
print("Alcohol summaries for quality = 4")
summary(subset(wine$alcohol, wine$quality==4))
print("Alcohol summaries for quality = 5")
summary(subset(wine$alcohol, wine$quality==5))
```
I noticed tha the wine quality increases with sulphates. However, having more of it will not help much sulphates are only good for quality upto a certain level.

### Plot Three
This boxplot shows the correlation between quality and residual sugar vs. alcohol. I observe that lower residual sugars and higher alcohol leads to better wine quality.
```{r}
ggplot(data=wine, aes(x=residual.sugar, y=alcohol))+
  facet_wrap(~rating) +
  geom_jitter(alpha=0.3)+
  geom_point() +
  #geom_boxplot(alpha=0.5, color='blue')+
  xlab('Residual sugar (g/dm^3)')+
  ylab('Alcohol (% volume)') +
  ggtitle('residual sugar vs. alcohol correlation by quality')
```

## Reflections

This study about white wine reveals following:
<ul><li>Most wines in the dataset are rated as 'average' just small number is rated as bad.</li>
<li>The data about citric acid is not accurate because many entries are set to 0.</li>
<li>Higher alcohol level impacts the wine rating. That is, higher alcohol means better wine.</li>
<li>More alcohol and low resifual sugars yield to good red wines.</li>
<li>Residual sugar and chlorides do not seem to have much impact on wine quality.</li>
<li>The lower volatile acidity the better wine (as there is negative correlation).</li>
</ul>

Given that only alcohol correlated with quality of wine, it suggests that alcohol has impact on wine quality. However there are other factors like harvest year, vineyard location, temperature of harvest missing from the dataset. It will be interesting to do further exploration on these factors and see how it affects the quality of wine.

My major struggle in this project was to find more information about the wine that would have been important in this study. I spent sometime online researching about information on wines and this project increased my knowledge about wines. I think next time while drinking wine I will recall this project and check if my rating matches with what I have discovered.


## Thank you